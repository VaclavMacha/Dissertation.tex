% ------------------------------------------------------------------------------
% Math
% ------------------------------------------------------------------------------
\let\originalleft\left
\let\originalright\right
\renewcommand{\left}{\mathopen{}\mathclose\bgroup\originalleft}
\renewcommand{\right}{\aftergroup\egroup\originalright}

% ------------------------------------------------------------------------------
% Theorems
% ------------------------------------------------------------------------------
\mdfdefinestyle{theoremstyle}{
  linecolor = myblue!50,
  backgroundcolor = myblue!10,
  frametitlebackgroundcolor = myblue!50,
  outerlinewidth = 1pt,
  roundcorner = 1pt,
  frametitlerule = true,
  skipabove = 5pt,
  skipbelow = 0pt,
}

\newmdtheoremenv[style = theoremstyle]{thm}{Theorem}[chapter]
\mdtheorem[style = theoremstyle]{theorem}[thm]{Theorem}
\mdtheorem[style = theoremstyle]{lemma}[thm]{Lemma}
\mdtheorem[style = theoremstyle]{corollary}[thm]{Corollary}
\mdtheorem[style = theoremstyle]{proposition}[thm]{Proposition}

% Definition style
\mdfdefinestyle{definitionstyle}{
  linecolor = mygreen!50,
  backgroundcolor = mygreen!10,
  frametitlebackgroundcolor = mygreen!50,
  outerlinewidth = 1pt,
  roundcorner = 1pt,
  frametitlerule = true,
  skipabove = 5pt,
  skipbelow = 0pt,
}
\mdtheorem[style = definitionstyle]{definition}[thm]{Definition}

% Example style
\mdfdefinestyle{examplestyle}{
  linecolor = myyellow!50,
  backgroundcolor = myyellow!10,
  frametitlebackgroundcolor = myyellow!50,
  outerlinewidth = 1pt,
  roundcorner = 1pt,
  frametitlerule = true,
  skipabove = 5pt,
  skipbelow = 0pt,
}
\mdtheorem[style = examplestyle]{example}[thm]{Example}
\mdtheorem[style = examplestyle]{notation}[thm]{Notation}


% Note style
\mdfdefinestyle{notestyle}{
  linecolor = myorange!50,
  backgroundcolor = myorange!10,
  frametitlebackgroundcolor = myorange!50,
  outerlinewidth = 1pt,
  roundcorner = 1pt,
  frametitlerule = true,
  skipabove = 5pt,
  skipbelow = 0pt,
}
\mdtheorem[style = notestyle]{note}[thm]{Note}

% Proof style
\mdfdefinestyle{proofstyle}{
  linecolor = myred,
  linewidth = 1pt,
  topline = false,
  bottomline = false,
  rightline = false,
  innertopmargin = 0pt,
  innerbottommargin = 0pt,
  innerrightmargin = 0pt,
  skipabove = 0pt,
  skipbelow = 0pt,
}

\renewcommand{\qedsymbol}{{\color{myred} $\blacksquare$}}

\renewenvironment{proof}[1][\proofname]
{ 
  \begin{mdframed}[style=proofstyle]%
  \noindent{\color{myred}\textit{\textbf{#1:}}}\par\nobreak\noindent\ignorespaces%
}
{%
  \nobreak\noindent\ignorespaces\qed
  \end{mdframed}
}

% ------------------------------------------------------------------------------
% Optional arguments
% ------------------------------------------------------------------------------
\newcommand{\NumberOfPages}[1]{\newcommand\@NumberOfPages{#1}}
\newcommand{\Year}[1]{\newcommand\@Year{#1}}
\newcommand{\AcademicYear}[1]{\newcommand\@AcademicYear{#1}}
\newcommand{\Acknowledgment}[1]{\newcommand\@Acknowledgment{#1}}
\newcommand{\Declaration}[1]{\newcommand\@Declaration{#1}}

\newcommand{\AuthorAffCZE}[1]{\newcommand\@AuthorAffCZE{#1}}
\newcommand{\AuthorAffENG}[1]{\newcommand\@AuthorAffENG{#1}}

\newcommand{\Supervisor}[1]{\newcommand\@Supervisor{#1}}
\newcommand{\SupervisorAffCZE}[1]{\newcommand\@SupervisorAffCZE{#1}}
\newcommand{\SupervisorAffENG}[1]{\newcommand\@SupervisorAffENG{#1}}

\newcommand{\SupervisorSpec}[1]{\newcommand\@SupervisorSpec{#1}}
\newcommand{\SupervisorSpecAffCZE}[1]{\newcommand\@SupervisorSpecAffCZE{#1}}
\newcommand{\SupervisorSpecAffENG}[1]{\newcommand\@SupervisorSpecAffENG{#1}}

\newcommand{\TitleCZE}[1]{\newcommand\@TitleCZE{#1}}
\newcommand{\DegreeProgrammeCZE}[1]{\newcommand\@DegreeProgrammeCZE{#1}}
\newcommand{\FieldCZE}[1]{\newcommand\@FieldCZE{#1}}
\newcommand{\AbstractCZE}[1]{\newcommand\@AbstractCZE{#1}}
\newcommand{\KeywordsCZE}[1]{\newcommand\@KeywordsCZE{#1}}

\newcommand{\TitleENG}[1]{\newcommand\@TitleENG{#1}}
\newcommand{\DegreeProgrammeENG}[1]{\newcommand\@DegreeProgrammeENG{#1}}
\newcommand{\FieldENG}[1]{\newcommand\@FieldENG{#1}}
\newcommand{\AbstractENG}[1]{\newcommand\@AbstractENG{#1}}
\newcommand{\KeywordsENG}[1]{\newcommand\@KeywordsENG{#1}}

\newcommand{\subtitle}[1]{\renewcommand\@subtitle{#1}}
\newcommand\@subtitle{}
\renewcommand\@date{}

% ------------------------------------------------------------------------------
% Title page
% ------------------------------------------------------------------------------
\renewcommand*{\maketitle}{
  \pagenumbering{Roman}
  \hypersetup{pageanchor=false}
  \begin{titlepage}
    \raggedleft
    \begin{minipage}[b][\textheight]{0.15\textwidth}
      \includegraphics[width=\textwidth]{images/logocvut.pdf} \par
      \vfill
      \includegraphics[width=\textwidth]{images/logofjfi.pdf} \par
    \end{minipage}
    \hspace{0.05\textwidth}
    \doccol \rule{2pt}{\textheight}
    \hspace{0.05\textwidth}
    \begin{minipage}[b][\textheight]{0.7\textwidth}
      \begin{minipage}[b]{\textwidth}
        \centering \doccol \Large
        \textbf{Czech Technical University in Prague} \par
        \textbf{Faculty of Nuclear Sciences and} \par
        \textbf{Physical Engineering}
      \end{minipage} \par
      \vfill
      \begin{minipage}[b]{\textwidth}
        \centering \doccol \huge \textsc{Doctoral Thesis}
      \end{minipage} \par
      \vspace{1cm}
      \begin{minipage}[b]{\textwidth}
        \centering  \doccol \huge \textbf{\@title}
      \end{minipage} \par
      \vfill
      \begin{minipage}[b]{0.95\textwidth}
        Prague, \@Year
        \hfill
        \@author
      \end{minipage}
    \end{minipage}
  \end{titlepage}
  \cleardoublepage

  % Thanks ...
  \thispagestyle{plain}
  \noindent
  \begin{minipage}[t]{\textwidth}\vspace{0pt}%
    \doccol \Large \textbf{Acknowledgements:}
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{\textwidth}\vspace{0pt}%
    \@Acknowledgment
  \end{minipage} \par
  \vfill
  \noindent
  \begin{minipage}[t]{\textwidth}\vspace{0pt}%
    \doccol \Large \textbf{Declaration:}
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{\textwidth}\vspace{0pt}%
    \@Declaration
  \end{minipage} \par
  \vspace{1.5cm}
  \noindent
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    V Praze dne \@date
  \end{minipage}
  \begin{minipage}[t]{0.3\textwidth}\vspace{0pt}%
    \centering ~ \par \textbf{\dotfill} \par \@author
  \end{minipage}
  \clearpage

  % Czech bibliography entry
  \thispagestyle{plain}
  \section*{Bibliografický záznam}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Autor:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@author, \par
    \@AuthorAffCZE
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Název práce:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \textbf{\@TitleCZE}
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Studijní program:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@DegreeProgrammeCZE
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Studijní obor:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@FieldCZE
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Školitel:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@Supervisor, \par
    \@SupervisorAffCZE
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Školitel specialista:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@SupervisorSpec, \par
    \@SupervisorSpecAffCZE 
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Akademický rok:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@AcademicYear
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Počet stran:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@NumberOfPages
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Klíčová slova:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@KeywordsCZE
  \end{minipage} \par
  \vfill
  \clearpage

  % Czech abstract
  \thispagestyle{plain}
  \section*{Abstrakt}
  \noindent
  \@AbstractCZE
  \vfill
  \clearpage

  % English bibliography entry
  \thispagestyle{plain}
  \section*{Bibliographic Entry}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Author:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@author, \par
    \@AuthorAffENG
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Title of Dissertation:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \textbf{\@TitleENG}
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Degree Programme:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@DegreeProgrammeENG
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Field of Study:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@FieldENG
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Supervisor:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@Supervisor, \par
    \@SupervisorAffENG
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Supervisor Specialist:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@SupervisorSpec, \par
    \@SupervisorSpecAffENG 
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Academic Year:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@AcademicYear
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Number of Pages:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@NumberOfPages
  \end{minipage} \par
  \vspace{0.5cm}
  \noindent
  \begin{minipage}[t]{0.25\textwidth}\vspace{0pt}%
    \doccol \textbf{Keywords:}
  \end{minipage}
  \hspace{0.05\textwidth}
  \begin{minipage}[t]{0.7\textwidth}\vspace{0pt}%
    \@KeywordsENG
  \end{minipage} \par
  \vfill
  \clearpage

  % English abstract
  \thispagestyle{plain}
  \section*{Abstract}
  \noindent
  \@AbstractENG
  \vfill
  \cleardoublepage

  \hypersetup{pageanchor=true}
  \tableofcontents
  \cleardoublepage
  \mainmatter
}

% Title style
\allsectionsfont{\doccol}
\newcommand{\titlebox}[1]{\parbox[b][][b]{\textwidth}{#1}}

% Part and chapter style
\titleformat{\chapter}[display]
  {\doccol \bfseries \huge}
  {\filleft {\fontsize{1.5cm}{1cm}\selectfont\thechapter}}
  {0ex}
  {\titlebox{#1}}
  [{\titlerule[2pt]}]

\titleformat{\part}[display]
   {\doccol \Huge \bfseries \filcenter}
   {\partname{} \thepart}
   {0em}
   {{\titlerule[4pt]} #1}

\assignpagestyle{\part}{plain}

% pga sep
\newskip\linepagesep\linepagesep10pt\relax
\def\vfootline{\begingroup \doccol \rule[-990pt]{2pt}{1000pt} \endgroup}

% fancy page style
\pagestyle{fancy}
\renewcommand{\chaptermark}[1]{\markboth{\thechapter \ #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection \ #1}}
\renewcommand{\footrulewidth}{0pt}
\renewcommand{\headrulewidth}{2pt}
\renewcommand{\headrule}{\hbox to\headwidth{\doccol\leaders\hrule height \headrulewidth \hfill}}

\fancyhf{}
\fancyhead[RO]{\doccol \textbf{\nouppercase{\leftmark}}}
\fancyhead[LE]{\doccol \textbf{\nouppercase{\rightmark}}}
\fancyfoot[RO]{\doccol \vfootline \hskip \linepagesep \textbf{\thepage}}
\fancyfoot[LE]{\doccol \textbf{\thepage} \hskip \linepagesep \vfootline}

% plain page style
\fancypagestyle{plain}{
  \renewcommand{\headrulewidth}{0pt}
  \fancyhf{}
  \fancyfoot[RO]{\doccol \vfootline \hskip \linepagesep \textbf{\thepage}}
  \fancyfoot[LE]{\doccol \textbf{\thepage} \hskip \linepagesep \vfootline}
}

% empty page style
\def\cleardoublepage{
  \clearpage
    \if@twoside
      \ifodd\c@page\else
      \hbox{}
      \thispagestyle{plain}
      \newpage
    \fi
  \fi
}
